<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‚˜ë§Œì˜ ì•„íŠ¸ ìŠ¤íŠœë””ì˜¤</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    #drawingCanvas { background-color: #fff; touch-action: none; border: 1px solid #e5e7eb; }
    .cursor-brush { cursor: crosshair; }
    .cursor-text { cursor: text; }
    .cursor-grab { cursor: grab !important; }
    .template-thumbnail {
      width: 40px; height: 40px; object-fit: cover; cursor: pointer;
      border-radius: 6px; border: 2px solid transparent; transition: transform 0.1s;
    }
    .template-thumbnail:hover { transform: scale(1.05); }
    .template-thumbnail.active { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.5); }
    #messageBox { opacity: 0; transition: opacity 0.3s, transform 0.3s; transform: translateY(10px) translateX(-50%); }
    #messageBox.show { opacity: 1; transform: translateY(0) translateX(-50%); }
  </style>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-gray-50 min-h-screen p-3 flex flex-col items-center">
  <div id="messageBox" class="fixed top-5 left-1/2 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-xl z-50"></div>

  <div class="w-full max-w-5xl bg-white rounded-xl shadow-2xl p-6 space-y-4">
    <header class="text-center">
      <h1 class="text-3xl font-extrabold text-gray-800 flex items-center justify-center space-x-2">
        <i data-lucide="palette" class="w-7 h-7 text-blue-600"></i>
        <span>ë‚˜ë§Œì˜ ì•„íŠ¸ ìŠ¤íŠœë””ì˜¤</span>
      </h1>
      <p class="text-gray-500 mt-1">ë¡œë¥´ìƒ¤í ì´ë¯¸ì§€ ìœ„ì—ì„œ ë‹¹ì‹ ì˜ ìƒìƒë ¥ì„ í‘œí˜„í•´ë³´ì„¸ìš”.</p>
    </header>

    <!-- í…œí”Œë¦¿ ì„ íƒ -->
    <div class="p-3 bg-gray-100 rounded-xl shadow-inner">
      <span class="text-sm font-semibold text-gray-700 block mb-2">ğŸ¨ ë°°ê²½ í…œí”Œë¦¿ ì„ íƒ (ë¡œë¥´ìƒ¤í ì´ë¯¸ì§€)</span>
      <div id="templateContainer" class="flex space-x-3 overflow-x-auto pb-1"></div>
    </div>

    <!-- ë„êµ¬ ë° ìº”ë²„ìŠ¤ -->
    <div class="flex flex-col lg:flex-row space-y-4 lg:space-x-4">
      <div class="bg-gray-100 p-4 rounded-xl shadow-lg lg:w-48 flex flex-col space-y-3 flex-shrink-0">
        <div class="flex space-x-3">
          <button id="brushTool" class="tool-button w-10 h-10 bg-blue-500 text-white rounded-lg active" data-mode="brush">
            <i data-lucide="paintbrush" class="w-5 h-5 mx-auto"></i>
          </button>
          <button id="textTool" class="tool-button w-10 h-10 bg-gray-600 text-white rounded-lg" data-mode="text">
            <i data-lucide="type" class="w-5 h-5 mx-auto"></i>
          </button>
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">ìƒ‰ìƒ ì„ íƒ</label>
          <input type="color" id="colorPicker" value="#000000" class="w-full h-8 rounded-md border-2 border-gray-300" />
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">í…ìŠ¤íŠ¸ ë‚´ìš©</label>
          <input type="text" id="textInput" placeholder="ì…ë ¥ í›„ Enter í‚¤" class="w-full p-2 rounded-md border border-gray-300 text-gray-800" />
          <p id="textHint" class="text-xs text-red-500 mt-1 hidden">Enter í›„ ìº”ë²„ìŠ¤ í´ë¦­</p>
        </div>
        <div class="h-px bg-gray-300 my-2"></div>
        <div>
          <label class="text-sm font-medium text-gray-700">í¬ê¸°: <span id="sizeValue">5</span>px</label>
          <input type="range" id="sizeSlider" min="1" max="50" value="5" class="w-full" />
        </div>
      </div>

      <div class="flex-grow bg-gray-200 rounded-xl shadow-inner flex justify-center items-center p-2">
        <canvas id="drawingCanvas" class="rounded-lg shadow-xl"></canvas>
      </div>
    </div>

    <!-- ë²„íŠ¼ -->
    <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-x-4 pt-4 border-t border-gray-200">
      <button id="saveButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl">
        <i data-lucide="download" class="w-5 h-5 inline mr-2"></i> ê·¸ë¦¼ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ & ê³µìœ 
      </button>
      <button onclick="undoLastAction()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-xl">
        <i data-lucide="undo-2" class="w-5 h-5 inline mr-2"></i> ë˜ëŒë¦¬ê¸°
      </button>
      <button onclick="clearCanvas(false)" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-xl">
        <i data-lucide="trash-2" class="w-5 h-5 inline mr-2"></i> ì „ì²´ ì§€ìš°ê¸°
      </button>
    </div>

    <div class="pt-4">
      <h2 class="text-lg font-semibold text-gray-700 mb-2">âœ¨ ë‚˜ë§Œì˜ ì˜ê° / í”„ë¡¬í”„íŠ¸ ì…ë ¥</h2>
      <textarea id="promptInput" placeholder="ì´ ê·¸ë¦¼ì— ëŒ€í•œ ìƒê°, ì•„ì´ë””ì–´ë¥¼ ê¸°ë¡í•´ ë³´ì„¸ìš”." class="w-full p-3 h-24 border border-gray-300 rounded-lg resize-none"></textarea>
    </div>
  </div>

  <script type="module">
    lucide.createIcons();
    const PADLET_URL = 'https://padlet.com/hy7191/padlet-vvey0i7aoep7kju6';
    const canvas = document.getElementById('drawingCanvas');
    const ctx = canvas.getContext('2d');

    // ğŸ”¹ ë¡œë¥´ìƒ¤í 1~10 ì´ë¯¸ì§€ ì „ì²´
    const templates = [
      { name: 'ë¡œë¥´ìƒ¤í 1', url: 'https://i.postimg.cc/kg20RfFr/1.png' },
      { name: 'ë¡œë¥´ìƒ¤í 2', url: 'https://i.postimg.cc/T3BZVgCY/2.png' },
      { name: 'ë¡œë¥´ìƒ¤í 3', url: 'https://i.postimg.cc/Jn3V40Ng/3.png' },
      { name: 'ë¡œë¥´ìƒ¤í 4', url: 'https://i.postimg.cc/rmGXFsGm/4.png' },
      { name: 'ë¡œë¥´ìƒ¤í 5', url: 'https://i.postimg.cc/nzKbcrKf/5.png' },
      { name: 'ë¡œë¥´ìƒ¤í 6', url: 'https://i.postimg.cc/ZRzzSpdM/6.png' },
      { name: 'ë¡œë¥´ìƒ¤í 7', url: 'https://i.postimg.cc/6q9s7KzL/7.png' },
      { name: 'ë¡œë¥´ìƒ¤í 8', url: 'https://i.postimg.cc/j2vpP1FY/8.png' },
      { name: 'ë¡œë¥´ìƒ¤í 9', url: 'https://i.postimg.cc/cLPVRwT2/9.png' },
      { name: 'ë¡œë¥´ìƒ¤í 10', url: 'https://i.postimg.cc/CxR3nmHT/10.png' }
    ];

    let currentColor = '#000000', currentSize = 5, drawingMode = 'brush', isDrawing = false;
    let history = [], currentTemplateUrl = '';

    function showMessage(msg, t = 5000) {
      const box = document.getElementById('messageBox');
      box.textContent = msg;
      box.classList.add('show');
      setTimeout(() => box.classList.remove('show'), t);
    }

    function resizeCanvas() {
      const container = canvas.parentElement;
      canvas.width = container.clientWidth - 20;
      canvas.height = canvas.width * 0.75;
    }

    function saveState() {
      if (history.length > 20) history.shift();
      history.push(canvas.toDataURL());
    }

    function undoLastAction() {
      if (history.length > 1) {
        history.pop();
        const img = new Image();
        img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        img.src = history[history.length - 1];
        showMessage('ë˜ëŒë¦¬ê¸° ì™„ë£Œ');
      } else showMessage('ë˜ëŒë¦´ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
    }
    window.undoLastAction = undoLastAction;

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (currentTemplateUrl) loadTemplate(currentTemplateUrl);
      showMessage('ìº”ë²„ìŠ¤ ì´ˆê¸°í™”');
    }
    window.clearCanvas = clearCanvas;

    // âœ… ì´ë¯¸ì§€ ë¹„ìœ¨ ìë™ ì¡°ì • + 50% ì¶•ì†Œ
    function loadTemplate(url) {
      currentTemplateUrl = url;
      const img = new Image();
      img.crossOrigin = 'Anonymous';
      img.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const scale = 0.5; // 50% í¬ê¸°
        const imgRatio = img.width / img.height;
        const canvasRatio = canvas.width / canvas.height;
        let drawWidth, drawHeight;

        if (imgRatio > canvasRatio) {
          drawWidth = canvas.width * scale;
          drawHeight = drawWidth / imgRatio;
        } else {
          drawHeight = canvas.height * scale;
          drawWidth = drawHeight * imgRatio;
        }

        const dx = (canvas.width - drawWidth) / 2;
        const dy = (canvas.height - drawHeight) / 2;

        ctx.drawImage(img, dx, dy, drawWidth, drawHeight);
        saveState();
      };
      img.src = url;
    }

    function initTemplates() {
      const container = document.getElementById('templateContainer');
      templates.forEach((tpl, i) => {
        const img = document.createElement('img');
        img.src = tpl.url;
        img.title = tpl.name;
        img.className = 'template-thumbnail';
        img.addEventListener('click', () => loadTemplate(tpl.url));
        container.appendChild(img);
        if (i === 0) loadTemplate(tpl.url);
      });
    }

    function getCanvasWithPrompt() {
      const promptText = document.getElementById('promptInput').value.trim();
      const temp = document.createElement('canvas');
      const tctx = temp.getContext('2d');
      temp.width = canvas.width; temp.height = canvas.height;
      tctx.drawImage(canvas, 0, 0);
      if (promptText) {
        tctx.fillStyle = '#000';
        tctx.font = '16px Inter';
        tctx.textAlign = 'center';
        tctx.fillText(promptText, temp.width / 2, temp.height - 20);
      }
      return temp.toDataURL('image/png');
    }

    // âœ¨ iOS & Android ë™ì‹œ ëŒ€ì‘ ë‹¤ìš´ë¡œë“œ ë¡œì§
    document.getElementById('saveButton').addEventListener('click', () => {
      const imageURL = getCanvasWithPrompt();
      const ua = navigator.userAgent;

      if (/iPhone|iPad|iPod/i.test(ua)) {
        window.open(imageURL, '_blank');
        showMessage('ğŸ–¼ ìƒˆ íƒ­ì—ì„œ ì—´ë¦° ì´ë¯¸ì§€ë¥¼ ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥í•˜ì„¸ìš”.');
      } else {
        const a = document.createElement('a');
        a.href = imageURL;
        a.download = `ë‚˜ë§Œì˜-ì•„íŠ¸-${Date.now()}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        showMessage('ğŸ–¼ ê·¸ë¦¼ì´ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }

      window.open(PADLET_URL, '_blank');
    });

    window.addEventListener('load', () => {
      resizeCanvas();
      initTemplates();
      canvas.classList.add('cursor-brush');
    });
    window.addEventListener('resize', resizeCanvas);

    canvas.addEventListener('mousedown', (e) => { isDrawing = true; ctx.beginPath(); ctx.moveTo(e.offsetX, e.offsetY); });
    canvas.addEventListener('mousemove', (e) => {
      if (isDrawing && drawingMode === 'brush') {
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentSize;
        ctx.stroke();
      }
    });
    canvas.addEventListener('mouseup', () => { isDrawing = false; saveState(); });
    document.getElementById('colorPicker').addEventListener('input', e => currentColor = e.target.value);
    document.getElementById('sizeSlider').addEventListener('input', e => {
      currentSize = e.target.value;
      document.getElementById('sizeValue').textContent = currentSize;
    });
  </script>
</body>
</html>
